<h1 class="text-center mb-4">{{product.title}}</h1>

<div class="row justify-content-center">
  <div class="col-md-6">
    <div class="card shadow">
      {{#if product.thumbnails.[0]}}
        <img src="/{{product.thumbnails.[0]}}" class="card-img-top" alt="{{product.title}}">
      {{else}}
        <img src="/images/default.jpg" class="card-img-top" alt="Sin imagen">
      {{/if}}
      <div class="card-body">
        <h5 class="card-title">Categor√≠a: {{product.category}}</h5>
        <p class="card-text">{{product.description}}</p>
        <p class="card-text"><strong>Precio:</strong> ${{product.price}}</p>
        <p class="card-text"><strong>Disponibilidad:</strong> {{product.stock}} unidades</p>

        <button class="btn btn-success add-to-cart-btn" data-product-id="{{product._id}}">
          Agregar al carrito üõí
        </button>
        <a href="/products" class="btn btn-secondary ms-2">Volver al cat√°logo</a>
      </div>
    </div>
  </div>
</div>

<script>
  const fixedCartId = "689d6b56ce1941e33823c12f"; // Usar el ID est√°tico por ahora

  document.querySelector('.add-to-cart-btn')?.addEventListener('click', async (e) => {
    const productId = e.target.getAttribute('data-product-id');

    try {
      const response = await fetch(`/api/carts/${fixedCartId}/products/${productId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      const result = await response.json();
      if (result.status === "success") {
        alert("‚úÖ Producto agregado al carrito");

        let currentCount = parseInt(localStorage.getItem("cartCount") || "0");
        localStorage.setItem("cartCount", currentCount + 1);
        const badge = document.getElementById("cart-count");
        if (badge) badge.textContent = currentCount + 1;
      } else {
        alert("‚ö†Ô∏è No se pudo agregar al carrito");
      }
    } catch (err) {
      console.error("‚ùå Error:", err);
      alert("‚ùå Error al agregar al carrito");
    }
  });
</script>
